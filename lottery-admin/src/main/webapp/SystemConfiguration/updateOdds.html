<html>
    <head>
        <title>添加下级代理</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style type="text/css">
        table{
            font-size: 15px;
            margin:20px auto;
            border-radius: 5px;
        }
        table th{
            padding:5 20 5 5;
            text-align: right;
            border: 1px solid #999999;
        }
        
        table td{
            padding:5 5 5 20;
            text-align: left;
            border: 1px solid #999999;
        }
        
        table tr:hover{
            background-color: #ccccff;
        }
        .numinput:hover{
            border:2px solid red ;
        }
        .submitinput{
            float: right;
            font-weight: bold;
            border-radius: 5px;
            margin-top: 30px;
            margin-right: 10%;
            font-size: 20px;
            border:1px solid #999999;;
            background-color: #99ffff;
            width: 100px;
            height: 50px;
        }
        .submitinput:hover{
            cursor: pointer;
            background-color: #ccccff;
        }
        a{
           cursor: pointer; 
        }
        .login_putin{
                width:243px;
                margin: 0 auto;
                padding: 0 0.8em;
                line-height: 36px;
                border: 1px solid #999;
                -webkit-border-radius:5px;
                -moz-border-radius: 5px;
                border-radius: 5px;
            }
            
            .displayNone{
            	display:none;
            }
            
        </style>
        <link href="../css/bootstrap.min14ed.css" rel="stylesheet">
        <script type="text/javascript" src="../js/jquery-1.10.2.min.js"></script>
        <script language="javascript" src="../js/layer/layer.min.js"></script>
        <script src="../js/self_js.js" type="text/javascript"></script>
        <link rel="stylesheet" href="../js/huakuai/main.css">
        <link rel="stylesheet" href="../js/huakuai/rangeslider.css">
        <script src="../js/huakuai/rangeslider.min.js"></script>
        <script src="../js/site.js" type="text/javascript"></script>
        
        <script type="text/javascript">
            $(document).ready(function () {
            	queryType();
                
                /* $("#userType option").each(function(){
                	                	
                	if($(this).val() == obj['agentUserType']){
                		$(this).attr('selected', true);
                		$('#userType').attr('disabled', true);
                		
                		$("#userType").trigger("change");
                		
                		//break;
                		return false;
                	}
                }); */
                
            });
            
            function queryType(){
                updateToken();
                var access_token=sessionStorage.getItem("access_token");
                var token="Bearer " + access_token;
                var lotteryType = $("#lotteryType").attr("id");
                var url= queryLotteTypesURL;
                $.ajax({
                    url: url,
                    type: "GET",
                    async: false, // 设置同步方式
                    data: {},
                    dataType: "json",
                    beforeSend: function (XMLHttpRequest) {
         				XMLHttpRequest.setRequestHeader("Authorization", token);
                    },
                    error: function () {
                        alert("系统错误");
                    },
                    success: function (data) {
                        if(data.status==1){
                            $.each(data.data, function(key, val) {  
                                     $("#" + lotteryType).append("<option value='"+val.codeName+"'>"+val.remark+"</option>");
                            }) 
                        }else if(data.status==0){
                            alert(getErroe(data.error_code));
                        }
                    }
                });
            }
            
            function queryPlayType(){
                updateToken();
                var access_token=sessionStorage.getItem("access_token");
                var token="Bearer " + access_token;
                var lotteryType = null;
                var url= queryPlayTypeURL;
                
                lotteryType = $("#lotteryType option:selected").val();
                
                $.ajax({
                    url: url,
                    type: "GET",
                    async: false, // 设置同步方式
                    data: {
                    	lotteryType:lotteryType
                    },
                    dataType: "json",
                    beforeSend: function (XMLHttpRequest) {
         				XMLHttpRequest.setRequestHeader("Authorization", token);
                    },
                    error: function () {
                        alert("系统错误");
                    },
                    success: function (data) {
                    	$("#playType").empty();
                        if(data.status==1){
                            $.each(data.data, function(key, val) {  
                                     $("#playType").append("<option value='"+val.id+"'>"+val.classification+"</option>");
                            }) 
                        }else if(data.status==0){
                            alert(getErroe(data.error_code));
                        }
                    }
                });
            }
            
            function queryPlayTypeNum(){
                updateToken();
                var access_token=sessionStorage.getItem("access_token");
                var token="Bearer " + access_token;
                var lotteryType = null;
                var playType = null;
                var marketType = null;
                
                lotteryType = $("#lotteryType").val();
                playType = $("#playType").val();
                marketType = $("#market").val();
                
                if(lotteryType == 'undefined' 
                		|| lotteryType == null
                		|| lotteryType == ''){
                	alert("请选择彩种!");
                	return;
                }
                
                if(playType == 'undefined' 
                		|| playType == null
                		|| playType == ''){
                	alert("请选择玩法!");
                	return;
                }
                
                if(marketType == 'undefined' 
            		|| marketType == null
            		|| marketType == ''){
            	alert("请选择盘口!");
            	return;
            }
                
                var url= queryLotteNumberURL.replace("{lotteryType}",lotteryType);
                url = url.replace("{playType}",playType);
                url = url.replace("{market}",marketType);
                $.ajax({
                    url: url,
                    type: "GET",
                    async: false, // 设置同步方式
                    data: {
                    },
                    dataType: "json",
                    beforeSend: function (XMLHttpRequest) {
         				XMLHttpRequest.setRequestHeader("Authorization", token);
                    },
                    error: function () {
                        alert("系统错误");
                    },
                    success: function (data) {
                        if(data.status==1){
                        	var tableid = $("#tableTRTD").attr("id");
                        	$("#" + tableid + "tr").remove();
                            $("#" + tableid).empty();
                            
                            $.each(data.data, function(key, val) {  
                            	var content = "<tr>\n";
                            	$.each(val, function(key1, val1) {  
                            		content += "<td class=\"thCenter\" style=\"vertical-align: middle;\">"+val1.betNum+"</td>\n";
   	                           	 	content += "<td class=\"thCenter\" data-sel=\"1\" data-num=\""+ val1.betNum +"\"><input style=\"width: 70px;\" type=\"text\" id=\""+val1.betNum+"\" value=\""+val1.currentOdds+"\" ></td>\n";
                            	});
	                           	 content += "</tr>";
                                $("#" + tableid).append(content);
                            }) 
                        }else if(data.status==0){
                            alert(getErroe(data.error_code));
                        }
                    }
                });
            }
            
            function updatePlayTypeNum(){
                updateToken();
                var access_token=sessionStorage.getItem("access_token");
                var token="Bearer " + access_token;
                var lotteryType = null;
                var playType = null;
				var marketType = null;
                
                lotteryType = $("#lotteryType").val();
                playType = $("#playType").val();
                marketType = $("#market").val();
                
                if(lotteryType == 'undefined' || lotteryType == null){
                	alert("请选择彩种!");
                	return;
                }
                
                if(playType == 'undefined' || playType == null){
                	alert("请选择玩法!");
                	return;
                }
                
                if(marketType == 'undefined' || marketType == null){
                	alert("请选择盘口!");
                	return;
                }
                
                var url= updateLotteNumberURL.replace("{lotteryType}",lotteryType);
                url = url.replace("{playType}",playType);
                url = url.replace("{market}",marketType);
                
                var playTypeNums = new Array();
                
                $('td[data-sel="1" ]').each(function(){
    				playTypeNum = {};
    				var betNum = $(this).attr("data-num");
    				var odds = $("#"+betNum).val();
    				playTypeNum.betNum = betNum;
    				playTypeNum.currentOdds = odds;
    				
    				if(typeof playTypeNum.currentOdds == 'undefined' 
    					|| playTypeNum.currentOdds == null
    					|| playTypeNum.currentOdds == ''){
    					alert('请输入赔率!');
    					return;
    				}
    				
    				playTypeNums.push(playTypeNum);
    				
    			});
                
                data=JSON.stringify(playTypeNums);
                
                $.ajax({
                    url: url,
                    type: "POST",
                    async: false, // 设置同步方式
                    data: data,
                    dataType: "json",
                    contentType:"application/json", 
                    beforeSend: function (XMLHttpRequest) {
         				XMLHttpRequest.setRequestHeader("Authorization", token);
                    },
                    error: function () {
                        alert("系统错误");
                    },
                    success: function (data) {
                        if(data.status==1){
                        	alert('成功修改');
                        }else if(data.status==0){
                            alert(getErroe(data.error_code));
                        }
                    }
                });
                
            }
        </script>
    </head>
    <body  style="max-width: 100%;">
        <div class="input-group" style="margin-left: 20px; float: left;margin-bottom: 70px;margin-top: 30px;">
                        彩种：<select id="lotteryType" name="lotteryType" style="width:200px;" class="form-control" onchange="queryPlayType()">
                                <option value="">&#45;&#45;选择彩种&#45;&#45;</option>
                            </select> 
        </div>
        <div class="input-group" style="margin-left: 20px; float: left;margin-bottom: 70px;margin-top: 30px;">
                        玩法：<select id="playType" name="playType" style="width:200px;" class="form-control">
                                <option value="">&#45;&#45;选择彩种&#45;&#45;</option>
                            </select>
                        <!--<button type="button" class="btn btn-primary" style="height:32px;" onclick="querySysCode()">搜索</button>--> 
        </div>
        <div class="input-group" style="margin-left: 20px; float: left;margin-bottom: 70px;margin-top: 30px;">
                        盘口：<select id="market" name="market" style="width:200px;" class="form-control">
                                <option value="1">&#45;&#45;A 盘&#45;&#45;</option>
                                <option value="2">&#45;&#45;B 盘&#45;&#45;</option>
                                <option value="3">&#45;&#45;C 盘&#45;&#45;</option>
                            </select>
                        <!--<button type="button" class="btn btn-primary" style="height:32px;" onclick="querySysCode()">搜索</button>--> 
        </div>
        <div class="input-group" style="margin-left: 20px; float: left;margin-bottom: 70px;margin-top: 30px;">                        
        	<button type="button" class="btn btn-primary" style="height:32px;" onclick="queryPlayTypeNum()">搜索</button> 
        </div>
        <div class="ibox-content">
                <table class="table table-striped table-bordered table-hover dataTables-example">
                    <tbody id="tableTRTD">
                        
                    </tbody>
                </table>
            </div>
        <script>
            var wz = parent.layer.getFrameIndex(window.name);
        </script>
        <div style="margin-left:500px;">
            <button class="btn btn-primary" type="submit" onclick="updatePlayTypeNum()" style="width:80px">提交</button>
        </div>
    </body>
</html>
